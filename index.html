<!doctype html>
<html lang="en">
<head>
  <a href="satellite.html">üõ∞ View NOAA Satellite</a>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Weather Tracker ‚Äî HTML/CSS/JS</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --muted:#9aa9bf; --accent:#60a5fa; --glass: rgba(255,255,255,0.03);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#071028);color:#e6eef8}
    .app{max-width:900px;margin:48px auto;padding:20px}

    header{display:flex;align-items:center;gap:16px}
    h1{font-weight:600;margin:0;font-size:1.3rem}
    p.lead{margin:0;color:var(--muted);font-size:0.9rem}

    .card{background:linear-gradient(180deg,var(--card), rgba(12,18,30,0.8));border-radius:14px;padding:18px;margin-top:18px;box-shadow:0 8px 30px rgba(2,6,23,0.6)}

    .controls{display:flex;gap:12px;flex-wrap:wrap}
    .search{flex:1;min-width:180px;display:flex}
    input[type=text]{flex:1;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:var(--glass);color:inherit}
    button{padding:10px 12px;border-radius:10px;border:none;background:var(--accent);color:#042;cursor:pointer}
    button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}

    .grid{display:grid;grid-template-columns:1fr 320px;gap:18px;margin-top:18px}
    @media (max-width:800px){.grid{grid-template-columns:1fr}}

    .main-stats{display:flex;flex-direction:column;gap:14px}
    .current{display:flex;align-items:center;gap:18px}
    .temp{font-size:48px;font-weight:700}
    .meta{color:var(--muted)}

    .small-cards{display:flex;gap:12px;flex-wrap:wrap}
    .small{background:rgba(255,255,255,0.02);padding:12px;border-radius:10px;min-width:110px;text-align:center}
    .label{font-size:0.8rem;color:var(--muted)}
    .val{font-weight:600;margin-top:6px}

    .map-spot{height:220px;border-radius:10px;overflow:hidden;background:linear-gradient(180deg,#071b2a,#061226);display:flex;align-items:center;justify-content:center;color:var(--muted)}

    .footer{margin-top:12px;color:var(--muted);font-size:0.85rem}

    .spinner{width:20px;height:20px;border-radius:50%;border:3px solid rgba(255,255,255,0.06);border-top-color:var(--accent);animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    .weather-icon{width:96px;height:96px;display:flex;align-items:center;justify-content:center;border-radius:14px;background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01));}

    footer.small{margin-top:20px;color:var(--muted);font-size:12px}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <h1>Weather Tracker</h1>
        <p class="lead">Search a city or use your location. Uses OpenStreetMap & Open-Meteo (no API key required).</p>
      </div>
    </header>

    <div class="card">
      <div class="controls">
        <div class="search">
          <input id="q" placeholder="Enter city (e.g. London, Tokyo)" />
          <button id="searchBtn">Search</button>
        </div>
        <button id="locBtn" class="secondary">Use my location</button>
        <button id="toggleUnit" class="secondary">¬∞C / ¬∞F</button>
      </div>

      <div class="grid">
        <div class="main-stats">
          <div id="status" style="height:6px;margin-top:6px"></div>

          <div class="current" id="currentBox" style="display:none">
            <div class="weather-icon" id="iconBox" aria-hidden>
              <div id="iconSVG">üå§Ô∏è</div>
            </div>
            <div>
              <div class="temp" id="temp">--¬∞</div>
              <div class="meta" id="meta">-- ‚Ä¢ --</div>
            </div>
          </div>

          <div class="small-cards">
            <div class="small">
              <div class="label">Feels like</div>
              <div class="val" id="feels">--</div>
            </div>
            <div class="small">
              <div class="label">Wind</div>
              <div class="val" id="wind">--</div>
            </div>
            <div class="small">
              <div class="label">Pressure</div>
              <div class="val" id="press">--</div>
            </div>
            <div class="small">
              <div class="label">Humidity</div>
              <div class="val" id="hum">--</div>
            </div>
          </div>

          <div class="footer" id="locationName">No location selected</div>
        </div>

        <aside>
          <div class="card">
            <div class="map-spot" id="mapSpot">Map / preview</div>
            <div style="margin-top:12px">
              <strong>Hourly (next 24h)</strong>
              <div id="hourly" style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap"></div>
            </div>
          </div>
        </aside>
      </div>

      <div class="card" style="margin-top:12px">
        <strong>Raw request & credits</strong>
        <div style="margin-top:8px;color:var(--muted);font-size:0.9rem">Geocoding: Nominatim / Weather: Open-Meteo (no API key). You can deploy this to GitHub Pages directly.</div>
      </div>

    </div>

    <footer class="small">Built with ‚ù§Ô∏è ‚Äî Open-Meteo & OpenStreetMap. Tip: for production hide keys or use server-side proxies for paid APIs.</footer>
  </div>

  <script>
    // --- Utility & state ---
    const $ = id => document.getElementById(id);
    const status = $("status");
    const q = $("q");
    const searchBtn = $("searchBtn");
    const locBtn = $("locBtn");
    const toggleUnit = $("toggleUnit");
    const currentBox = $("currentBox");
    const tempEl = $("temp");
    const metaEl = $("meta");
    const iconSVG = $("iconSVG");
    const locationName = $("locationName");
    const feelsEl = $("feels");
    const windEl = $("wind");
    const pressEl = $("press");
    const humEl = $("hum");
    const hourlyEl = $("hourly");
    const mapSpot = $("mapSpot");

    let unit = 'C'; // or 'F'

    function setStatus(html){ status.innerHTML = html }
    function showLoading(){ setStatus('<div class="spinner"></div>') }

    // --- Weather helpers ---
    // Map Open-Meteo weathercode to emoji + text (small mapping)
    const wc = {
      0: ['‚òÄÔ∏è','Clear sky'],1:['üå§Ô∏è','Mainly clear'],2:['‚õÖ','Partly cloudy'],3:['‚òÅÔ∏è','Overcast'],
      45:['üå´Ô∏è','Fog'],48:['üå´Ô∏è','Depositing rime fog'],
      51:['üå¶Ô∏è','Light drizzle'],53:['üåßÔ∏è','Moderate drizzle'],55:['üåßÔ∏è','Dense drizzle'],
      61:['üåßÔ∏è','Slight rain'],63:['üåßÔ∏è','Moderate rain'],65:['üåßÔ∏è','Heavy rain'],
      71:['üå®Ô∏è','Slight snow'],73:['üå®Ô∏è','Moderate snow'],75:['üå®Ô∏è','Heavy snow'],
      80:['üåßÔ∏è','Rain showers'],95:['‚õàÔ∏è','Thunderstorm']
    };

    function fmtTemp(t){
      if(unit==='C') return Math.round(t)+"¬∞C";
      return Math.round(t*9/5+32)+"¬∞F";
    }

    function fetchGeo(query){
      // Nominatim public search (OpenStreetMap)
      const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}`;
      return fetch(url,{headers:{'Accept':'application/json'}}).then(r=>r.json());
    }

    async function fetchWeather(lat,lon){
      // Open-Meteo current + hourly (no key)
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=temperature_2m&timezone=auto&temperature_unit=celsius`;
      const res = await fetch(url);
      return res.json();
    }

    function renderCurrent(data, place){
      if(!data || !data.current_weather) return;
      const cw = data.current_weather;
      currentBox.style.display='flex';
      const code = cw.weathercode;
      iconSVG.textContent = wc[code] ? wc[code][0] : 'üå§Ô∏è';
      tempEl.textContent = fmtTemp(cw.temperature);
      metaEl.textContent = `${wc[code] ? wc[code][1] : 'Weather'} ‚Ä¢ ${cw.time}`;
      locationName.textContent = place;
      feelsEl.textContent = fmtTemp(cw.temperature);
      windEl.textContent = `${Math.round(cw.windspeed)} m/s ${cw.winddirection ?? ''}`;
      pressEl.textContent = `-- hPa`; // Open-Meteo current_weather doesn't include pressure; would require additional params
      humEl.textContent = `--%`;

      // hourly peek
      hourlyEl.innerHTML='';
      if(data.hourly && data.hourly.temperature_2m){
        const now = new Date();
        for(let i=0;i<24 && i<data.hourly.temperature_2m.length;i++){
          const t = data.hourly.temperature_2m[i];
          const el = document.createElement('div');
          el.style.minWidth='56px';el.style.padding='6px';el.style.borderRadius='8px';el.style.background='rgba(255,255,255,0.02)';el.style.textAlign='center';
          const hour = new Date(); hour.setHours(now.getHours()+i);
          el.innerHTML = `<div style="font-size:0.85rem">${hour.getHours()}:00</div><div style="font-weight:700;margin-top:6px">${fmtTemp(t)}</div>`;
          hourlyEl.appendChild(el);
        }
      }

      // map preview: small static map using OSM tile (no api)
      mapSpot.innerHTML = `<div style="width:100%;height:100%;"><iframe style='border:0;width:100%;height:100%' src='https://www.openstreetmap.org/export/embed.html?bbox=${place.lon-0.5}%2C${place.lat-0.5}%2C${place.lon+0.5}%2C${place.lat+0.5}&layer=mapnik&marker=${place.lat}%2C${place.lon}'></iframe></div>`;
    }

    async function doSearch(qstr){
      try{
        showLoading();
        const geos = await fetchGeo(qstr);
        if(!geos || geos.length===0){ setStatus('No results'); return }
        const first = geos[0];
        const lat = parseFloat(first.lat); const lon = parseFloat(first.lon);
        const w = await fetchWeather(lat,lon);
        setStatus('');
        renderCurrent({...w}, {name:first.display_name, lat, lon});
      }catch(err){ setStatus('Error: '+err.message) }
    }

    // Handle geolocation (browser)
    locBtn.addEventListener('click',()=>{
      if(!navigator.geolocation) return setStatus('Geolocation not supported');
      setStatus('Getting location...');
      navigator.geolocation.getCurrentPosition(async pos =>{
        const lat = pos.coords.latitude; const lon = pos.coords.longitude;
        const w = await fetchWeather(lat,lon);
        setStatus('');
        renderCurrent(w,{name:`Lat ${lat.toFixed(3)}, Lon ${lon.toFixed(3)}`, lat, lon});
      }, err => setStatus('Permission denied or error'));
    });

    searchBtn.addEventListener('click',()=>{ const v=q.value.trim(); if(!v) return; doSearch(v); });
    q.addEventListener('keydown',e=>{ if(e.key==='Enter') searchBtn.click() });

    toggleUnit.addEventListener('click',()=>{
      unit = unit==='C' ? 'F' : 'C';
      toggleUnit.textContent = unit==='C' ? '¬∞C / ¬∞F' : '¬∞F / ¬∞C';
      // re-render with same displayed values (best-effort)
      const tempText = tempEl.textContent.replace(/[¬∞CF]/g,'');
      if(tempText && !isNaN(Number(tempText))){
        // do nothing ‚Äî we will keep as-is because we don't store original metric in this simple demo
      }
    });

    // small friendly demo: load a default city
    (function init(){ q.value='New York'; searchBtn.click(); })();
  </script>
</body>
</html>
