<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Weather Tracker â€” HTML/CSS/JS</title>
<style>
:root{
  --bg:#0f1724; --card:#0b1220; --muted:#9aa9bf; --accent:#60a5fa; --glass: rgba(255,255,255,0.03);
  font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#071028);color:#e6eef8}
.app{max-width:900px;margin:48px auto;padding:20px}

header{display:flex;align-items:center;gap:16px}
h1{font-weight:600;margin:0;font-size:1.3rem}
p.lead{margin:0;color:var(--muted);font-size:0.9rem}

.card{background:linear-gradient(180deg,var(--card), rgba(12,18,30,0.8));border-radius:14px;padding:18px;margin-top:18px;box-shadow:0 8px 30px rgba(2,6,23,0.6)}

.controls{display:flex;gap:12px;flex-wrap:wrap}
.search{flex:1;min-width:180px;display:flex}
input[type=text]{flex:1;padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:var(--glass);color:inherit}
button{padding:10px 12px;border-radius:10px;border:none;background:var(--accent);color:#042;cursor:pointer}
button.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}

.grid{display:grid;grid-template-columns:1fr 320px;gap:18px;margin-top:18px}
@media (max-width:800px){.grid{grid-template-columns:1fr}}

.main-stats{display:flex;flex-direction:column;gap:14px}
.current{display:flex;align-items:center;gap:18px}
.temp{font-size:48px;font-weight:700}
.meta{color:var(--muted)}

.small-cards{display:flex;gap:12px;flex-wrap:wrap}
.small{background:rgba(255,255,255,0.02);padding:12px;border-radius:10px;min-width:110px;text-align:center}
.label{font-size:0.8rem;color:var(--muted)}
.val{font-weight:600;margin-top:6px}

.map-spot{height:220px;border-radius:10px;overflow:hidden;background:linear-gradient(180deg,#071b2a,#061226);display:flex;align-items:center;justify-content:center;color:var(--muted)}

.footer{margin-top:12px;color:var(--muted);font-size:0.85rem}

.spinner{width:20px;height:20px;border-radius:50%;border:3px solid rgba(255,255,255,0.06);border-top-color:var(--accent);animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}

.weather-icon{width:96px;height:96px;display:flex;align-items:center;justify-content:center;border-radius:14px;background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01));}

footer.small{margin-top:20px;color:var(--muted);font-size:12px}

.forecast{display:flex;gap:8px;overflow-x:auto;margin-top:12px}
.forecast-day{min-width:72px;background:rgba(255,255,255,0.02);border-radius:8px;padding:6px;text-align:center}
.aqi-card{margin-top:12px;padding:12px;background:rgba(255,255,255,0.02);border-radius:10px}
</style>
</head>
<body>
<div class="app">
<header>
  <div>
    <h1>Weather Tracker</h1>
    <p class="lead">Search a city or use your location. Uses OpenStreetMap & Open-Meteo (no API key required).</p>
  </div>
</header>

<div class="card">
  <div class="controls">
    <div class="search">
      <input id="q" placeholder="Enter city (e.g. London, Tokyo)"/>
      <button id="searchBtn">Search</button>
    </div>
    <button id="locBtn" class="secondary">Use my location</button>
    <button id="toggleUnit" class="secondary">Â°C / Â°F</button>
  </div>

  <div class="grid">
    <div class="main-stats">
      <div id="status" style="height:6px;margin-top:6px"></div>

      <div class="current" id="currentBox" style="display:none">
        <div class="weather-icon" id="iconBox" aria-hidden>
          <div id="iconSVG">ğŸŒ¤ï¸</div>
        </div>
        <div>
          <div class="temp" id="temp">--Â°</div>
          <div class="meta" id="meta">-- â€¢ --</div>
        </div>
      </div>

      <div class="small-cards">
        <div class="small">
          <div class="label">Feels like</div>
          <div class="val" id="feels">--</div>
        </div>
        <div class="small">
          <div class="label">Wind</div>
          <div class="val" id="wind">--</div>
        </div>
        <div class="small">
          <div class="label">Pressure</div>
          <div class="val" id="press">--</div>
        </div>
        <div class="small">
          <div class="label">Humidity</div>
          <div class="val" id="hum">--</div>
        </div>
      </div>

      <div class="small-cards">
        <div class="small">
          <div class="label">Sunrise</div>
          <div class="val" id="sunrise">--:--</div>
        </div>
        <div class="small">
          <div class="label">Sunset</div>
          <div class="val" id="sunset">--:--</div>
        </div>
        <div class="small">
          <div class="label">Moon Phase</div>
          <div class="val" id="moonphase">--</div>
        </div>
      </div>

      <div class="forecast" id="forecast"></div>
      <div class="aqi-card" id="aqiCard">AQI: --</div>

      <div class="footer" id="locationName">No location selected</div>
    </div>

    <aside>
      <div class="card">
        <div class="map-spot" id="mapSpot">Map / preview</div>
        <div style="margin-top:12px">
          <strong>Hourly (next 24h)</strong>
          <div id="hourly" style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap"></div>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <strong>Local Radar</strong>
        <div id="radarSpot" class="map-spot">Loading radar...</div>
      </div>
    </aside>
  </div>
</div>

<footer class="small">Built with â¤ï¸ â€” Open-Meteo & OpenStreetMap.</footer>
</div>

<script>
const $=id=>document.getElementById(id);
const status=$("status"), q=$("q"), searchBtn=$("searchBtn"), locBtn=$("locBtn"), toggleUnit=$("toggleUnit");
const currentBox=$("currentBox"), tempEl=$("temp"), metaEl=$("meta"), iconSVG=$("iconSVG"), locationName=$("locationName");
const feelsEl=$("feels"), windEl=$("wind"), pressEl=$("press"), humEl=$("hum"), hourlyEl=$("hourly"), mapSpot=$("mapSpot");
const forecastDiv=$("forecast"), sunriseEl=$("sunrise"), sunsetEl=$("sunset"), moonphaseEl=$("moonphase"), aqiCard=$("aqiCard"), radarSpot=$("radarSpot");
let unit='C';

function setStatus(html){status.innerHTML=html;}
function showLoading(){setStatus('<div class="spinner"></div>');}

const wc={0:['â˜€ï¸','Clear'],1:['ğŸŒ¤ï¸','Mainly clear'],2:['â›…','Partly cloudy'],3:['â˜ï¸','Overcast'],45:['ğŸŒ«ï¸','Fog'],48:['ğŸŒ«ï¸','Rime fog'],51:['ğŸŒ¦ï¸','Light drizzle'],53:['ğŸŒ§ï¸','Moderate drizzle'],55:['ğŸŒ§ï¸','Dense drizzle'],61:['ğŸŒ§ï¸','Rain'],63:['ğŸŒ§ï¸','Rain'],65:['ğŸŒ§ï¸','Heavy rain'],71:['ğŸŒ¨ï¸','Snow'],73:['ğŸŒ¨ï¸','Snow'],75:['ğŸŒ¨ï¸','Heavy snow'],80:['ğŸŒ§ï¸','Rain showers'],95:['â›ˆï¸','Thunderstorm']};

function fmtTemp(t){return unit==='C'?Math.round(t)+"Â°C":Math.round(t*9/5+32)+"Â°F";}

async function fetchGeo(query){
  const url=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}`;
  const res=await fetch(url,{headers:{'Accept':'application/json'}});
  return res.json();
}

async function fetchWeather(lat,lon){
  const url=`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=temperature_2m&daily=temperature_2m,weathercode,sunrise,sunset,moonphase&timezone=auto&temperature_unit=celsius`;
  const res=await fetch(url);
  return res.json();
}

async function fetchAQI(lat,lon){
  try{
    const res=await fetch(`https://api.waqi.info/feed/geo:${lat};${lon}/?token=demo`);
    const data=await res.json();
    if(data.status==="ok") return data.data.aqi;
    return null;
  }catch{return null;}
}

function renderCurrent(data, place){
  if(!data || !data.current_weather) return;
  const cw=data.current_weather;
  currentBox.style.display='flex';
  const code=cw.weathercode;
  iconSVG.textContent=wc[code]?wc[code][0]:'ğŸŒ¤ï¸';
  tempEl.textContent=fmtTemp(cw.temperature);
  metaEl.textContent=`${wc[code]?wc[code][1]:'Weather'} â€¢ ${cw.time}`;
  locationName.textContent=place.name;
  feelsEl.textContent=fmtTemp(cw.temperature);
  windEl.textContent=`${Math.round(cw.windspeed)} m/s ${cw.winddirection??''}`;
  pressEl.textContent=`-- hPa`;
  humEl.textContent=`--%`;

  // Hourly
  hourlyEl.innerHTML='';
  if(data.hourly && data.hourly.temperature_2m){
    const now=new Date();
    for(let i=0;i<24 && i<data.hourly.temperature_2m.length;i++){
      const t=data.hourly.temperature_2m[i];
      const el=document.createElement('div');
      el.style.minWidth='56px'; el.style.padding='6px'; el.style.borderRadius='8px'; el.style.background='rgba(255,255,255,0.02)'; el.style.textAlign='center';
      const hour=new Date(); hour.setHours(now.getHours()+i);
      el.innerHTML=`<div style="font-size:0.85rem">${hour.getHours()}:00</div><div style="font-weight:700;margin-top:6px">${fmtTemp(t)}</div>`;
      hourlyEl.appendChild(el);
    }
  }

  // Daily forecast
  forecastDiv.innerHTML='';
  if(data.daily && data.daily.temperature_2m){
    for(let i=0;i<data.daily.temperature_2m.length;i++){
      const t=data.daily.temperature_2m[i];
      const dayEl=document.createElement('div');
      dayEl.className='forecast-day';
      const d=new Date(data.daily.time[i]);
      const code=data.daily.weathercode[i];
      dayEl.innerHTML=`<div>${d.toLocaleDateString('en-US',{weekday:'short'})}</div><div style="font-size:1.2rem">${wc[code]?wc[code][0]:'ğŸŒ¤ï¸'}</div><div>${fmtTemp(t.max)}/${fmtTemp(t.min)}</div>`;
      forecastDiv.appendChild(dayEl);
    }
  }

  // Sun/Moon
  if(data.daily){
    sunriseEl.textContent=new Date(data.daily.sunrise[0]).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
    sunsetEl.textContent=new Date(data.daily.sunset[0]).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
    const phase=data.daily.moonphase[0];
    moonphaseEl.textContent=phase<0.03?'ğŸŒ‘':phase<0.25?'ğŸŒ“':phase<0.5?'ğŸŒ•':phase<0.75?'ğŸŒ—':'ğŸŒ‘';
  }

  // Map
  mapSpot.innerHTML=`<div style="width:100%;height:100%;"><iframe style='border:0;width:100%;height:100%' src='https://www.openstreetmap.org/export/embed.html?bbox=${place.lon-0.5}%2C${place.lat-0.5}%2C${place.lon+0.5}%2C${place.lat+0.5}&layer=mapnik&marker=${place.lat}%2C${place.lon}'></iframe></div>`;

  // Radar
  radarSpot.innerHTML=`<iframe src="https://www.rainviewer.com/map.html?loc=${place.lat},${place.lon},8&oFa=0&oC=0&oAP=0" style="border:0;width:100%;height:100%"></iframe>`;

  // AQI
  fetchAQI(place.lat,place.lon).then(aqi=>{
    aqiCard.textContent='AQI: '+(aqi??'N/A');
  });
}

async function doSearch(qstr){
  try{
    showLoading();
    const geos=await fetchGeo(qstr);
    if(!geos||geos.length===0){ setStatus('No results'); return; }
    const first=geos[0];
    const lat=parseFloat(first.lat), lon=parseFloat(first.lon);
    const w=await fetchWeather(lat,lon);
    setStatus('');
    renderCurrent(w,{name:first.display_name,lat,lon});
  }catch(err){setStatus('Error: '+err.message);}
}

locBtn.addEventListener('click',()=>{
  if(!navigator.geolocation) return setStatus('Geolocation not supported');
  setStatus('Getting location...');
  navigator.geolocation.getCurrentPosition(async pos=>{
    const lat=pos.coords.latitude, lon=pos.coords.longitude;
    const w=await fetchWeather(lat,lon);
    setStatus('');
    renderCurrent(w,{name:`Lat ${lat.toFixed(3)}, Lon ${lon.toFixed(3)}`,lat,lon});
  },err=>setStatus('Permission denied or error'));
});

searchBtn.addEventListener('click',()=>{const v=q.value.trim(); if(v) doSearch(v);});
q.addEventListener('keydown',e=>{if(e.key==='Enter') searchBtn.click();});

toggleUnit.addEventListener('click',()=>{unit=unit==='C'?'F':'C'; toggleUnit.textContent = unit==='C'?'Â°C / Â°F':'Â°F / Â°C';});

// Load default city
(async function init(){
  const defaultCity={name:'New York',lat:40.7128,lon:-74.0060};
  const w=await fetchWeather(defaultCity.lat,defaultCity.lon);
  renderCurrent(w,defaultCity);
})();
</script>
</body>
</html>
